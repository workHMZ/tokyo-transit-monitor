# =============================================================================
# è‡ªåŠ¨å¯åŠ¨ Stirling PDF æœåŠ¡å™¨
# =============================================================================
# è§¦å‘ï¼šæ¯å¤©æ—©ä¸Š 7:00 (JST) è‡ªåŠ¨å¯åŠ¨ æˆ– æ‰‹åŠ¨è§¦å‘
# åŠŸèƒ½ï¼šå”¤é†’ Azure VM è¿è¡Œ PDF æœåŠ¡
# =============================================================================

name: â˜€ï¸ Start PDF Server (Daily 7AM)

on:
  # å®šæ—¶è§¦å‘ï¼šæ¯å¤©æ—©ä¸Š 7:00 JST (= å‰ä¸€å¤© 22:00 UTC)
  schedule:
    - cron: '0 22 * * *'
  
  # æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

env:
  AZURE_RESOURCE_GROUP: rg-stirling-project
  AZURE_VM_NAME: vm-stirling-pdf

jobs:
  start-vm:
    name: ğŸŒ Wake up Stirling PDF
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ” Azure Login
        uses: azure/login@v2
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}

      - name: âš¡ Start VM
        uses: azure/CLI@v2
        with:
          inlineScript: |
            echo "ğŸ”„ æ­£åœ¨å”¤é†’ PDF æœåŠ¡å™¨..."
            az vm start \
              --resource-group ${{ env.AZURE_RESOURCE_GROUP }} \
              --name ${{ env.AZURE_VM_NAME }}
            echo "âœ… vm-stirling-pdf å·²å¯åŠ¨ï¼"

      - name: ğŸŒ Get VM Public IP
        uses: azure/CLI@v2
        with:
          inlineScript: |
            IP=$(az vm show -d \
              --resource-group ${{ env.AZURE_RESOURCE_GROUP }} \
              --name ${{ env.AZURE_VM_NAME }} \
              --query publicIps -o tsv)
            echo "ğŸ“ PDF æœåŠ¡å™¨ IP: $IP"
